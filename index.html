<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>mktgstack</title>
  <meta name="description" content="mktgstack is an agency built on the belief that not every marketing problem needs an advertising campaign.">

  <!-- Open Graph -->
  <meta property="og:title" content="mktgstack">
  <meta property="og:description" content="mktgstack is an agency built on the belief that not every marketing problem needs an advertising campaign.">
  <meta property="og:image" content="https://mktg-stack.com/og-image.png">
  <meta property="og:url" content="https://mktg-stack.com">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="mktgstack">
  <meta name="twitter:description" content="mktgstack is an agency built on the belief that not every marketing problem needs an advertising campaign.">
  <meta name="twitter:image" content="https://mktg-stack.com/og-image.png">

  <link rel="icon" type="image/png" href="favicon.png" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rethink+Sans:ital,wght@0,400..800;1,400..800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%; height: 100%;
      overflow: hidden;
      background: #1a1a1a;
      font-family: 'Arial Black', 'Helvetica Neue', Arial, sans-serif;
      -webkit-font-smoothing: antialiased;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: none;
      position: fixed;
      inset: 0;
    }

    .layer {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
    }

    /* ── Dot grid ── */
    #dot-grid { z-index: 1; pointer-events: none; }

    /* ── Main compositing canvas ── */
    #main-canvas { z-index: 3; pointer-events: none; }

    /* ── UI overlay ── */
    #ui-overlay { z-index: 10; pointer-events: none; }
    #ui-overlay a, #ui-overlay button { pointer-events: auto; }

    /* ── Social icons (top-left) ── */
    .social-icons {
      position: absolute; top: clamp(10px, 4vw, 53px); left: clamp(10px, 4vw, 62px);
      display: flex; flex-direction: column; align-items: flex-start; gap: 6px;
    }
    .desktop-social-bar {
      position: relative; display: inline-block;
    }
    .desktop-email-link {
      color: #fff;
      font-family: 'Rethink Sans', Arial, sans-serif;
      font-size: 13px;
      text-decoration: none;
      white-space: nowrap;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55))
              drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
      transition: filter 0.3s ease;
    }
    .desktop-social-bar img {
      height: clamp(24px, 3vw, 36px); width: auto; display: block;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55)) drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .desktop-social-link {
      position: absolute; top: 0; bottom: 0;
      display: block;
    }

    /* ── Grid wordmark (top-right) ── */
    .grid-wordmark {
      position: absolute; top: clamp(10px, 3.5vw, 48px); right: clamp(10px, 4vw, 62px);
      height: clamp(28px, 4.5vw, 58px); width: auto;
      display: block; text-decoration: none;
      transition: filter 0.3s ease;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55)) drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    /* no inversion — wordmark stays yellow */

    /* ── Old shuffle button — hidden ── */
    .shuffle-btn { display: none; }

    /* ── Sticker button (bottom-left, top layer) ── */
    .stickermktgstack {
      position: fixed; bottom: clamp(10px, 3.5vw, 49px); left: clamp(10px, 4vw, 62px);
      z-index: 10001;
      background: none; border: none;
      padding: 40px;
      margin: -40px;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }
    .stickermktgstack img {
      height: clamp(36px, 4vw, 56px); width: auto;
      pointer-events: none;
      display: block;
      transition: transform 0.15s ease;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55))
              drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .stickermktgstack:hover img { transform: scale(1.08); }
    .stickermktgstack:active img { transform: scale(0.92); }
    .stickermktgstack.shuffling img { animation: shufflePop 0.4s ease; }
    @keyframes shufflePop {
      0%   { transform: scale(1) rotate(0deg); }
      30%  { transform: scale(1.25) rotate(-15deg); }
      60%  { transform: scale(0.9) rotate(5deg); }
      100% { transform: scale(1) rotate(0deg); }
    }

    /* ── Treatment label (hidden) ── */
    .treatment-label { display: none; }

    /* ── Shuffle burst ── */
    #shuffle-burst {
      position: fixed; z-index: 5; pointer-events: none;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.12) 0%, transparent 70%);
      transform: scale(0); opacity: 0;
      will-change: transform, opacity;
    }
    #shuffle-burst.active {
      animation: burstExpand 0.7s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    }
    @keyframes burstExpand {
      0%   { transform: scale(0); opacity: 1; }
      100% { transform: scale(1); opacity: 0; }
    }

    /* ── Sticker mode ── */
    .sticker-layer {
      position: fixed; inset: 0;
      z-index: 10000; pointer-events: none;
      display: none;
    }
    body.sticker-mode .sticker-layer { display: block; pointer-events: auto; }
    body.sticker-mode { cursor: none; }
    .sticker-cursor {
      position: fixed;
      width: 280px; height: auto;
      pointer-events: none;
      z-index: 9998;
      transform: translate(-50%, -50%);
      opacity: 0.6;
      display: none;
    }
    body.sticker-mode .sticker-cursor { display: block; }
    .sticker-stamp {
      position: absolute;
      width: 280px; height: auto;
      --rot: 0deg;
      transform: translate(-50%, -50%) scale(0) rotate(0deg);
      animation: stickerPop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      pointer-events: none;
    }
    .sticker-stamp img {
      width: 100%; height: auto;
    }
    @keyframes stickerPop {
      0%   { transform: translate(-50%, -50%) scale(0) rotate(0deg); }
      100% { transform: translate(-50%, -50%) scale(1) rotate(var(--rot)); }
    }
    .sticker-stamp.popping-out {
      animation: stickerPopOut 0.4s cubic-bezier(0.55, 0, 1, 0.45) forwards;
    }
    @keyframes stickerPopOut {
      0%   { transform: translate(-50%, -50%) scale(1) rotate(var(--rot)); opacity: 1; }
      100% { transform: translate(-50%, -50%) scale(0) rotate(calc(var(--rot) + 180deg)); opacity: 0; }
    }

    /* ── Mobile UI elements (hidden on desktop) ── */
    .mobile-ui {
      display: none;
      position: absolute; inset: 0;
      pointer-events: none;
      z-index: 10;
    }
    .mobile-ui a, .mobile-ui button { pointer-events: auto; }

    .mobile-wordmark {
      position: absolute; top: calc(14% - 7px); left: 50%;
      transform: translateX(-50%);
      height: 46px; width: auto;
      display: block; text-decoration: none;
      transition: opacity 0.3s;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55)) drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .mobile-tagline-btn {
      position: absolute; top: calc(53.5% + 50px); left: 50%;
      transform: translateX(-50%);
      background: none; border: none; padding: 0; cursor: pointer;
      width: 82%; max-width: 295px;
    }
    .mobile-tagline-btn img {
      display: block; width: 100%; height: auto;
    }
    .mobile-social {
      position: absolute; bottom: 7%; right: 24px;
      display: flex; flex-direction: column; align-items: flex-end; gap: 5px;
    }
    .mobile-social-wrap {
      position: relative; display: inline-block;
    }
    .mobile-email-link {
      color: #fff;
      font-family: 'Rethink Sans', Arial, sans-serif;
      font-size: 11px;
      text-decoration: none;
      white-space: nowrap;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55))
              drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .mobile-social-wrap img {
      display: block; height: 28px; width: auto;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55)) drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .mobile-social-link {
      position: absolute; top: 0; bottom: 0;
      text-decoration: none;
    }
    .mobile-shuffle { display: none; }

    /* ── Mobile sticker/shuffle button (fixed, top layer) ── */
    .shufflemobMktg {
      display: none;
      position: fixed; bottom: 7%; left: 18px;
      background: none; border: none;
      padding: 20px;
      margin: -10px;
      cursor: pointer;
      z-index: 10001;
      transition: opacity 0.3s ease, transform 0.15s ease;
      -webkit-tap-highlight-color: transparent;
    }
    .shufflemobMktg:active img { transform: scale(0.92); }
    .shufflemobMktg img {
      height: 34px; width: auto;
      pointer-events: none;
      display: block;
      transition: transform 0.15s ease;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55)) drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .shufflemobMktg.shuffling img { animation: shufflePop 0.4s ease; }

    .sticker-hint {
      display: none;
      position: fixed; bottom: calc(7% + 54px); left: 18px;
      color: #fff;
      font-family: 'Rethink Sans', Arial, sans-serif;
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
      z-index: 10001;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55))
              drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }

    /* ── Mobile responsive ── */

    /* ── Desktop tagline below logo ── */
    .desktop-tagline-btn {
      position: absolute;
      bottom: clamp(20px, 5vw, 77px);
      left: 50%;
      transform: translate(-50%, 50%);
      width: clamp(200px, 28.8%, 416px);
      z-index: 4;
      background: none; border: none; padding: 0; cursor: pointer;
      transition: opacity 0.3s ease;
    }
    .desktop-tagline-btn img {
      width: 100%; height: auto; display: block;
      pointer-events: none;
    }

    /* ── Desktop manifesto mode elements ── */
    .desktop-manifesto-text {
      position: absolute;
      top: 50%; right: clamp(20px, 4vw, 62px);
      transform: translateY(-50%);
      width: 43.75%;
      display: flex; align-items: flex-start; justify-content: flex-start;
      opacity: 0; transform: translateY(calc(-50% + 16px));
      transition: opacity 0.3s, transform 0.3s;
      pointer-events: none; z-index: 1;
    }
    .desktop-manifesto-text img {
      width: 100%; height: 100%;
      object-fit: contain; object-position: top left;
    }
    .manifesto-copy {
      color: #FAFF40;
      font-family: "Rethink Sans", sans-serif;
      font-optical-sizing: auto;
      font-weight: 400;
      font-style: normal;
      text-align: justify;
      text-align-last: left;
      line-height: 1.35;
      word-spacing: -0.5px;
      letter-spacing: -0.3px;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.4)) drop-shadow(-1px 0 0 rgba(0,0,0,0.4))
              drop-shadow(0 1px 0 rgba(0,0,0,0.4)) drop-shadow(0 -1px 0 rgba(0,0,0,0.4));
    }
    .manifesto-copy p { margin: 0 0 1em; }
    .manifesto-copy p:last-child { margin-bottom: 0; }
    .desktop-manifesto-text .manifesto-copy {
      font-size: clamp(14px, 1.25vw, 19px);
    }
    .manifesto-body .manifesto-copy {
      font-size: clamp(11px, 3vw, 14px);
      font-weight: 500;
      width: 85%;
      text-align-last: center;
      letter-spacing: -0.5px;
      word-spacing: -1px;
    }
    .desktop-manifesto-back {
      position: absolute; bottom: clamp(10px, 3.5vw, 49px); left: clamp(10px, 4vw, 62px);
      background: none; border: none; padding: 4px;
      cursor: pointer; opacity: 0;
      transition: opacity 0.3s 0.3s;
      pointer-events: none; z-index: 6;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55))
              drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .desktop-manifesto-back:hover { transform: scale(1.1); }
    .desktop-manifesto-back:active { transform: scale(0.9); }
    .desktop-manifesto-back svg { display: block; }

    /* ── Desktop manifesto active ── */
    #ui-overlay.desktop-manifesto-mode .desktop-tagline-btn {
      opacity: 0; pointer-events: none;
    }
    #ui-overlay.desktop-manifesto-mode .desktop-manifesto-text {
      opacity: 1; transform: translateY(-50%); pointer-events: auto;
      transition: opacity 0.5s 0.3s, transform 0.5s 0.3s;
    }
    #ui-overlay.desktop-manifesto-mode .desktop-manifesto-back {
      opacity: 1; pointer-events: auto;
    }
    #ui-overlay.desktop-manifesto-mode .shuffle-btn {
      opacity: 0; pointer-events: none;
    }
    #ui-overlay.desktop-manifesto-mode ~ .stickermktgstack {
      opacity: 0; pointer-events: none;
    }

    /* Tablet */
    @media (max-width: 1024px) {
      .sticker-stamp { width: 260px; }
      .sticker-cursor { width: 260px; }
    }

    /* Phone / portrait — switch to mobile UI */
    /* Tablet */
    @media (min-width: 769px) and (max-width: 1024px) {
      .desktop-tagline-btn { width: 36%; }
      .desktop-manifesto-text { width: 55%; }
    }

    @media (max-width: 768px) {
      .social-icons { display: none; }
      .grid-wordmark { display: none; }
      .shuffle-btn { display: none; }
      .stickermktgstack { display: none; }
      .desktop-tagline-btn { display: none; }
      .desktop-manifesto-text { display: none; }
      .desktop-manifesto-back { display: none; }
      .mobile-ui { display: block; }
      .shufflemobMktg { display: block; }
      .sticker-hint { display: block; }
      .sticker-stamp { width: 200px; }
      .sticker-cursor { width: 200px; }
    }

    @media (max-width: 480px) {
      .mobile-wordmark { height: 38px; }
      .mobile-tagline-btn { width: 86%; }
      .mobile-social-wrap img { height: 24px; }
      .shufflemobMktg img { height: 30px; }
      .sticker-stamp { width: 140px; }
      .sticker-cursor { width: 140px; }
    }

    @media (max-width: 360px) {
      .mobile-wordmark { height: 32px; }
      .mobile-tagline-btn { width: 88%; }
      .mobile-social-wrap img { height: 22px; }
      .shufflemobMktg img { height: 28px; }
      .sticker-stamp { width: 120px; }
    }

    /* Landscape phone — show rotate overlay */
    .rotate-overlay {
      display: none;
      position: fixed; inset: 0;
      background: #1a1a1a;
      z-index: 99999;
      flex-direction: column;
      align-items: center; justify-content: center;
      gap: 20px;
      color: #fff;
      font-family: 'Rethink Sans', Arial, sans-serif;
      font-size: 15px;
      letter-spacing: 0.3px;
    }
    .rotate-overlay svg {
      width: 44px; height: 44px;
      opacity: 0.8;
      animation: rotateHint 2s ease-in-out infinite;
    }
    @keyframes rotateHint {
      0%, 100% { transform: rotate(0deg); }
      50% { transform: rotate(-90deg); }
    }
    @media (max-height: 500px) and (orientation: landscape) and (max-width: 1024px) {
      .rotate-overlay { display: flex; }
      .shufflemobMktg { display: block; }
      .sticker-hint { display: block; }
    }

    /* Hide sticker cursor on touch — finger is the cursor */
    @media (hover: none) {
      .sticker-cursor { display: none !important; }
      body.sticker-mode { cursor: auto; }
    }


    /* ── Manifesto flex layout ── */
    .manifesto-layout {
      position: absolute; inset: 0;
      display: flex; flex-direction: column;
      padding-top: calc(env(safe-area-inset-top, 0px) + 14px);
      padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 14px);
      padding-left: 24px; padding-right: 24px;
      opacity: 0; pointer-events: none;
      transition: opacity 0.4s 0.2s;
      z-index: 3;
    }
    .manifesto-header {
      display: flex; justify-content: space-between; align-items: center;
      flex-shrink: 0;
    }
    .manifesto-back {
      background: none; border: none; padding: 6px;
      cursor: pointer; min-width: 44px; min-height: 44px;
      display: flex; align-items: center; justify-content: center;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55))
              drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .manifesto-back:active { transform: scale(0.9); }
    .manifesto-back svg { display: block; }
    .manifesto-header-wordmark {
      height: clamp(32px, 5vw, 42px); width: auto;
      display: block; text-decoration: none;
      filter: drop-shadow(1px 0 0 rgba(0,0,0,0.55)) drop-shadow(-1px 0 0 rgba(0,0,0,0.55))
              drop-shadow(0 1px 0 rgba(0,0,0,0.55)) drop-shadow(0 -1px 0 rgba(0,0,0,0.55));
    }
    .manifesto-logo-space {
      flex-shrink: 0;
      height: clamp(100px, 24vh, 180px);
    }
    .manifesto-body {
      flex: 1; min-height: 0;
      display: flex; justify-content: center; align-items: center;
      padding: 10px 4px;
      overflow: hidden;
    }
    .manifesto-body img {
      width: 80%; height: 100%;
      object-fit: contain; object-position: top center;
    }
    .manifesto-footer {
      flex-shrink: 0;
      display: flex; flex-direction: column; align-items: center;
      gap: 10px;
      padding-top: 16px;
    }
    .manifesto-footer-social {
      display: flex; flex-direction: column; align-items: center; gap: 4px;
      padding-bottom: 20px;
    }
    .manifesto-footer-social .mobile-social-wrap img {
      height: 24px;
    }
    .manifesto-footer-social .mobile-email-link {
      font-size: 10px;
    }

    /* Tagline + social + shuffle transitions */
    .mobile-tagline-btn { transition: opacity 0.3s; }
    .mobile-social { transition: opacity 0.3s; }
    .mobile-shuffle { transition: opacity 0.3s; }

    /* Disable tagline click in sticker mode */
    body.sticker-mode .mobile-tagline-btn { pointer-events: none; }
    body.sticker-mode .mobile-shuffle { position: fixed; }
    body.sticker-mode .desktop-tagline-btn { pointer-events: none; }

    /* ── When manifesto is active ── */
    .mobile-ui.manifesto-mode .mobile-tagline-btn {
      opacity: 0; pointer-events: none;
    }
    .mobile-ui.manifesto-mode .mobile-wordmark {
      opacity: 0; pointer-events: none;
    }
    .mobile-ui.manifesto-mode .mobile-shuffle {
      opacity: 0; pointer-events: none;
    }
    .mobile-ui.manifesto-mode ~ .shufflemobMktg {
      opacity: 0; pointer-events: none;
    }
    .mobile-ui.manifesto-mode .mobile-social {
      opacity: 0; pointer-events: none;
    }
    .mobile-ui.manifesto-mode .manifesto-layout {
      opacity: 1; pointer-events: auto;
    }

    /* ── Loading ── */
    #loader {
      position: fixed; inset: 0; z-index: 9999;
      background: #1a1a1a; display: flex;
      flex-direction: column; gap: 16px;
      align-items: center; justify-content: center;
      transition: opacity 0.8s ease;
    }
    #loader.hidden { opacity: 0; pointer-events: none; }
    .spinner {
      width: 40px; height: 40px; border: 3px solid #2a2a2a;
      border-top-color: #E8E430; border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .load-text {
      color: rgba(232, 228, 48, 0.4);
      font-size: 10px; letter-spacing: 3px;
      text-transform: uppercase;
    }
  </style>
</head>
<body>

  <div id="loader">
    <div class="spinner"></div>
    <div class="load-text">Loading</div>
  </div>

  <canvas id="dot-grid" class="layer"></canvas>
  <canvas id="main-canvas" class="layer"></canvas>

  <div class="rotate-overlay">
    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="6" y="1" width="12" height="22" rx="2" stroke="#fff" stroke-width="1.5"/><line x1="12" y1="19" x2="12" y2="19.01" stroke="#fff" stroke-width="2" stroke-linecap="round"/></svg>
    Please rotate your device to portrait mode
  </div>

  <svg style="position:absolute;width:0;height:0;pointer-events:none;" aria-hidden="true">
    <defs>
      <filter id="liquid-distort" x="-30%" y="-30%" width="160%" height="160%">
        <feTurbulence id="turb" type="fractalNoise" baseFrequency="0.018 0.018"
          numOctaves="3" seed="5" result="noise"/>
        <feDisplacementMap in="SourceGraphic" in2="noise" scale="28"
          xChannelSelector="R" yChannelSelector="G"/>
      </filter>
    </defs>
  </svg>

  <div id="shuffle-burst"></div>

  <div id="ui-overlay" class="layer">
    <div class="social-icons" id="social-icons">
      <div class="desktop-social-bar">
        <img src="iconsDesktop/social.svg" alt="Social links" draggable="false" />
        <a href="https://www.linkedin.com/company/mktgstack/?viewAsMember=true" target="_blank" rel="noopener" aria-label="LinkedIn" class="desktop-social-link" style="left:0;width:33%"></a>
        <a href="https://x.com/MktgStack" target="_blank" rel="noopener" aria-label="X" class="desktop-social-link" style="left:33%;width:34%"></a>
        <a href="https://www.instagram.com/mktgstack" target="_blank" rel="noopener" aria-label="Instagram" class="desktop-social-link" style="left:67%;width:33%"></a>
      </div>
      <a href="mailto:meet@mktg-stack.com" class="desktop-email-link">meet@mktg-stack.com</a>
    </div>

    <!-- Grid wordmark — top-right -->
    <a href="https://www.talented.agency/" target="_blank" rel="noopener" id="grid-wordmark" class="grid-wordmark">
      <img src="latestgrudLofo.png" alt="talented (grid of companies)" draggable="false" style="height:100%;width:auto;" />
    </a>

    <button class="shuffle-btn" id="shuffle-btn" aria-label="Shuffle treatment">
      <img src="iconsDesktop/shuffle.svg" alt="Shuffle" draggable="false" />
    </button>

    <div class="treatment-label" id="treatment-label">fuzzy</div>

    <button class="desktop-tagline-btn" id="desktop-tagline-btn" aria-label="Read manifesto">
      <img src="22feb/taglineDesk.svg" alt="The answer to every marketing problem isn't an advertising campaign." draggable="false" />
    </button>

    <!-- Desktop manifesto text (fades in on right side of logo) -->
    <div class="desktop-manifesto-text" id="desktop-manifesto-text">
      <div class="manifesto-copy">
        <p>For modern brands and founders, expectations from marketing have fundamentally changed. The big campaign isn't marketing's centre of gravity any more. It reflects an era that no longer mirrors how audiences discover, engage, <span style="white-space:nowrap">and make decisions.</span></p>
        <p>The most effective brands are building their own distribution, telling stories through founders and operators, developing content and IP as <span style="white-space:nowrap">long-term</span> assets, and using AI and continuous optimisation to improve performance over time. They treat marketing as an <span style="white-space:nowrap">always-on</span> system designed <span style="white-space:nowrap">to learn, adapt, and compound.</span></p>
        <p>mktgstack is built for this reality. We are structured more like a speedboat than a cruise ship. Fast, focused, and deliberately lean. Our <span style="white-space:nowrap">AI-leveraged</span> operating model enables <span style="white-space:nowrap">high-quality</span> execution that once required far larger teams and traditional agency infrastructure. We concentrate on the levers that drive behaviour, adoption, and growth. Because if the work does not change outcomes, it does not matter <span style="white-space:nowrap">how good it looks.</span></p>
      </div>
    </div>
    <button class="desktop-manifesto-back" id="desktop-manifesto-back-btn" aria-label="Back">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 19l-7-7 7-7" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
    </button>
  </div>

  <!-- Mobile UI (hidden on desktop, shown on <=768px) -->
  <div class="mobile-ui" id="mobile-ui">
    <!-- Normal mode elements (absolute positioned) -->
    <a href="https://www.talented.agency/" target="_blank" rel="noopener" class="mobile-wordmark">
      <img src="latestgrudLofo.png" alt="talented (grid of companies)" draggable="false" style="height:100%;width:auto;" />
    </a>
    <button class="mobile-tagline-btn" id="mobile-tagline-btn" aria-label="Read more">
      <img src="Asset 27.png" alt="The answer to every marketing problem isn't an advertising campaign." draggable="false" />
    </button>
    <div class="mobile-social">
      <div class="mobile-social-wrap">
        <img src="iconsMob/Asset 10.svg" alt="Social links" draggable="false" />
        <a href="https://www.linkedin.com/company/mktgstack/?viewAsMember=true" target="_blank" rel="noopener" aria-label="LinkedIn" class="mobile-social-link" style="left:0;width:33%"></a>
        <a href="https://x.com/MktgStack" target="_blank" rel="noopener" aria-label="X" class="mobile-social-link" style="left:33%;width:34%"></a>
        <a href="https://www.instagram.com/mktgstack" target="_blank" rel="noopener" aria-label="Instagram" class="mobile-social-link" style="left:67%;width:33%"></a>
      </div>
      <a href="mailto:meet@mktg-stack.com" class="mobile-email-link">meet@mktg-stack.com</a>
    </div>
    <button class="mobile-shuffle" id="mobile-shuffle-btn" aria-label="Shuffle treatment">
      <img src="iconsMob/Asset 9.svg" alt="Shuffle" draggable="false" />
    </button>

    <!-- Manifesto layout (flex column, shown in manifesto-mode) -->
    <div class="manifesto-layout" id="manifesto-layout">
      <!-- Header row -->
      <div class="manifesto-header">
        <button class="manifesto-back" id="manifesto-back-btn" aria-label="Back">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 19l-7-7 7-7" stroke="#fff" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <a href="https://www.talented.agency/" target="_blank" rel="noopener" class="manifesto-header-wordmark">
          <img src="latestgrudLofo.png" alt="talented (grid of companies)" draggable="false" style="height:100%;width:auto;" />
        </a>
      </div>
      <!-- Logo breathing space (canvas shows through) -->
      <div class="manifesto-logo-space"></div>
      <!-- Body text -->
      <div class="manifesto-body">
        <div class="manifesto-copy">
          <p>For modern brands and founders, expectations from marketing have fundamentally changed. The big campaign isn't marketing's centre of gravity any more. It reflects an era that no longer mirrors how audiences discover, engage, <span style="white-space:nowrap">and make decisions.</span></p>
          <p>The most effective brands are building their own distribution, telling stories through founders and operators, developing content and IP as <span style="white-space:nowrap">long-term</span> assets, and using AI and continuous optimisation to improve performance over time. They treat marketing as an <span style="white-space:nowrap">always-on</span> system designed <span style="white-space:nowrap">to learn, adapt, and compound.</span></p>
          <p>mktgstack is built for this reality. We are structured more like a speedboat than a cruise ship. Fast, focused, and deliberately lean. Our <span style="white-space:nowrap">AI-leveraged</span> operating model enables <span style="white-space:nowrap">high-quality</span> execution that once required far larger teams and traditional agency infrastructure. We concentrate on the levers that drive behaviour, adoption, and growth. Because if the work does not change outcomes, it does not matter <span style="white-space:nowrap">how good it looks.</span></p>
        </div>
      </div>
      <!-- Footer -->
      <div class="manifesto-footer">
        <div class="manifesto-footer-social">
          <div class="mobile-social-wrap">
            <img src="iconsMob/Asset 10.svg" alt="Social links" draggable="false" />
            <a href="https://www.linkedin.com/company/mktgstack/?viewAsMember=true" target="_blank" rel="noopener" aria-label="LinkedIn" class="mobile-social-link" style="left:0;width:33%"></a>
            <a href="https://x.com/MktgStack" target="_blank" rel="noopener" aria-label="X" class="mobile-social-link" style="left:33%;width:34%"></a>
            <a href="https://www.instagram.com/mktgstack" target="_blank" rel="noopener" aria-label="Instagram" class="mobile-social-link" style="left:67%;width:33%"></a>
          </div>
          <a href="mailto:meet@mktg-stack.com" class="mobile-email-link">meet@mktg-stack.com</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Desktop sticker toggle (top-layer, outside overlay) -->
  <button class="stickermktgstack" id="stickermktgstack" aria-label="Shuffle treatment">
    <img src="iconsDesktop/shuffle.svg" alt="Shuffle" draggable="false" />
  </button>

  <!-- Mobile sticker toggle (top-layer, outside overlay) -->
  <button class="shufflemobMktg" id="shufflemobMktg" aria-label="Shuffle treatment">
    <img src="iconsMob/Asset 9.svg" alt="Shuffle" draggable="false" />
  </button>
  <div class="sticker-hint" id="sticker-hint">Tap the screen</div>

  <!-- Sticker cursor preview + placement layer -->
  <img class="sticker-cursor" id="sticker-cursor" src="sticker.png" alt="" draggable="false" />
  <div class="sticker-layer" id="sticker-layer"></div>

  <script>
  (function () {
    'use strict';

    /* ═══ TREATMENTS ═══ */
    const TREATMENTS = [
      {
        src: 'compressed_stills/desktop/neon_topaz.jpg',
        mobileSrc: 'compressed_stills/mobile/neon_mobile_topaz.jpg',
        name: 'neon',
        mobileYOff: -0.11,
      },
      {
        src: 'compressed_stills/desktop/candy_topaz.jpg',
        mobileSrc: 'compressed_stills/mobile/candy_mobile_topaz.jpg',
        name: 'candy',
        mobileYOff: -0.11,
        desktopAlign: { zoom: 0.9622, xOff: 0.00308, yOff: 0.00036 },
      },
      {
        src: 'compressed_stills/desktop/fuzzy_topaz.jpg',
        mobileSrc: 'compressed_stills/mobile/fuzzy_mobile_topaz.jpg',
        name: 'fuzzy',
        mobileYOff: -0.11,
      },
      {
        src: 'compressed_stills/desktop/balloon_topaz.jpg',
        mobileSrc: 'compressed_stills/mobile/balloon_mobile_topaz.jpg',
        name: 'balloon',
        mobileYOff: -0.11,
      },
      {
        src: 'compressed_stills/desktop/metallic_topaz.jpg',
        mobileSrc: 'compressed_stills/mobile/metallic_mobile_topaz.jpg',
        name: 'metallic',
        mobileYOff: -0.11,
      },
      {
        src: 'compressed_stills/desktop/chrome_topaz.jpg',
        mobileSrc: 'compressed_stills/mobile/chrome_mobile_topaz.jpg',
        name: 'chrome',
        mobileYOff: -0.11,
      },
    ];
    const DESKTOP_BASE_ASPECT = 16 / 9;
    let currentTreatment = 0;
    let prevTreatment = 0;
    let lastTreatmentSwitch = 0;
    let treatmentFade = 1.0;
    const TREATMENT_INTERVAL = 1250;  /* 1.25s per image */
    const TREATMENT_FADE_MS = 800;    /* smooth crossfade */
    const treatmentImages = [];
    const mobileTreatmentImages = [];

    /* ═══ DOM ═══ */
    const dotCanvas  = document.getElementById('dot-grid');
    const mainCanvas = document.getElementById('main-canvas');
    const loader     = document.getElementById('loader');
    const turbEl     = document.getElementById('turb');
    const labelEl    = document.getElementById('treatment-label');
    const socialEl   = document.getElementById('social-icons');
    const gridWmEl   = document.getElementById('grid-wordmark');
    const shuffleEl  = document.getElementById('stickermktgstack');

    /* ═══ CONTEXTS ═══ */
    const dotCtx  = dotCanvas.getContext('2d');
    const mainCtx = mainCanvas.getContext('2d');
    const blobCanvas = document.createElement('canvas');
    const blobCtx    = blobCanvas.getContext('2d');
    const blurCanvas = document.createElement('canvas');
    const blurCtx    = blurCanvas.getContext('2d');

    const logoCanvas = document.createElement('canvas');
    const logoCtx    = logoCanvas.getContext('2d');

    /* ═══ LOGO ═══ */
    const logoImg = new Image();
    logoImg.src = 'stack-logo.png';

    /* ═══ SIZING ═══ */
    let W, H;
    const dpr = Math.min(window.devicePixelRatio || 1, 3);
    function resize() {
      W = document.documentElement.clientWidth;
      H = document.documentElement.clientHeight;
      const bW = W * dpr, bH = H * dpr;
      dotCanvas.width  = bW;  dotCanvas.height  = bH;
      mainCanvas.width = bW;  mainCanvas.height = bH;
      blobCanvas.width = bW;  blobCanvas.height = bH;
      blurCanvas.width = bW;  blurCanvas.height = bH;
      /* Scale all contexts so drawing code stays in CSS-pixel coords */
      dotCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
      mainCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
      blobCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
      blurCtx.setTransform(dpr, 0, 0, dpr, 0, 0);
      buildDotPattern();
      prepareWhiteLogo();
    }

    function prepareWhiteLogo() {
      if (!logoImg.naturalWidth) return;
      const w = logoImg.naturalWidth, h = logoImg.naturalHeight;
      logoCanvas.width = w; logoCanvas.height = h;
      logoCtx.clearRect(0, 0, w, h);
      /* Draw original logo to extract alpha from its dark pixels */
      logoCtx.drawImage(logoImg, 0, 0);
      const data = logoCtx.getImageData(0, 0, w, h);
      const px = data.data;
      for (let i = 0; i < px.length; i += 4) {
        /* Original is dark logo on white bg — dark pixels are the logo */
        const brightness = (px[i] + px[i+1] + px[i+2]) / 3;
        /* Invert: make logo white, set alpha based on how dark the original was */
        px[i] = 255; px[i+1] = 255; px[i+2] = 255;
        px[i+3] = Math.round(255 - brightness);
      }
      logoCtx.putImageData(data, 0, 0);
    }

    /* ═══ DOT GRID ═══ */
    let dotPattern = null;
    function buildDotPattern() {
      const s = 48, tile = document.createElement('canvas');
      tile.width = s; tile.height = s;
      const tc = tile.getContext('2d');
      tc.fillStyle = 'rgba(255,255,255,0.035)';
      tc.beginPath(); tc.arc(s/2, s/2, 1, 0, Math.PI*2); tc.fill();
      dotPattern = dotCtx.createPattern(tile, 'repeat');
    }

    /* ═══ MOUSE STATE ═══ */
    let mouseX = 0, mouseY = 0;
    let cursorX = 0, cursorY = 0;
    let prevCX = 0, prevCY = 0;
    let mouseIn = false;
    let targetAlpha = 0, curAlpha = 0;
    const trail = [];
    const TRAIL_LIFE = 1800;  /* long-lasting trails like flowing paint */
    const LERP = 0.10;        /* slightly slower follow for flowing feel */

    /* ═══ EVENTS ═══ */
    const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

    document.addEventListener('mousemove', e => {
      mouseX = e.clientX; mouseY = e.clientY;
      mouseIn = true; targetAlpha = 1;
      if (stickerMode) {
        stickerCursor.style.left = e.clientX + 'px';
        stickerCursor.style.top = e.clientY + 'px';
      }
    });
    document.addEventListener('mouseleave', () => { mouseIn = false; targetAlpha = 0; });
    document.addEventListener('mouseenter', () => { mouseIn = true; targetAlpha = 1; });

    /* Touch support for blob reveal */
    document.addEventListener('touchstart', e => {
      const t = e.touches[0];
      mouseX = t.clientX; mouseY = t.clientY;
      cursorX = mouseX; cursorY = mouseY;
      mouseIn = true; targetAlpha = 1;
    }, { passive: true });
    document.addEventListener('touchmove', e => {
      const t = e.touches[0];
      mouseX = t.clientX; mouseY = t.clientY;
      mouseIn = true; targetAlpha = 1;
    }, { passive: true });
    document.addEventListener('touchend', () => { mouseIn = false; targetAlpha = 0; });

    window.addEventListener('resize', resize);
    window.addEventListener('orientationchange', () => setTimeout(resize, 100));

    /* ═══ MODE TOGGLE ═══ */
    let stickerMode = false;
    const stickerLayer = document.getElementById('sticker-layer');
    const stickerCursor = document.getElementById('sticker-cursor');
    const MAX_STICKERS = 20;
    let stickerCount = 0;

    /* Sticker image pool — cycle through sequentially */
    const STICKER_SRCS = [
      'sticker.png',
      '1x/Asset 1.png',
      '1x/Asset 2.png',
      '1x/Asset 3.png',
      '1x/Asset 4.png',
      'new stickers/Asset 26.png',
      'new stickers/Asset 27.png',
      'new stickers/Asset 28.png',
      'new stickers/Asset 29.png',
      'new stickers/Asset 30.png',
    ];
    let stickerIndex = 0;

    /* Shuffle toggle logic */
    const stickerHint = document.getElementById('sticker-hint');
    function toggleStickerMode(btnEl) {
      stickerMode = !stickerMode;
      document.body.classList.toggle('sticker-mode', stickerMode);
      labelEl.textContent = stickerMode ? 'sticker' : TREATMENTS[currentTreatment].name;

      /* Show/hide mobile hint */
      if (stickerHint) {
        if (stickerMode) {
          stickerHint.style.opacity = '1';
          setTimeout(() => { stickerHint.style.opacity = '0'; }, 2500);
        } else {
          stickerHint.style.opacity = '0';
        }
      }

      /* Clear stickers when exiting sticker mode */
      if (!stickerMode) {
        stickerLayer.innerHTML = '';
        stickerCount = 0;
        stickerIndex = 0;
      } else {
        /* Set cursor to current sticker */
        stickerCursor.src = STICKER_SRCS[stickerIndex];
      }

      /* pop animation */
      btnEl.classList.remove('shuffling');
      void btnEl.offsetWidth;
      btnEl.classList.add('shuffling');
    }

    /* Desktop shuffle button */
    shuffleEl.addEventListener('click', () => toggleStickerMode(shuffleEl));

    /* Mobile shuffle button (old — hidden) */
    const mobileShuffleEl = document.getElementById('mobile-shuffle-btn');
    if (mobileShuffleEl) {
      mobileShuffleEl.addEventListener('click', () => toggleStickerMode(mobileShuffleEl));
    }

    /* Mobile shuffle button (new — fixed top layer) */
    const shuffleMobEl = document.getElementById('shufflemobMktg');
    if (shuffleMobEl) {
      shuffleMobEl.addEventListener('click', () => toggleStickerMode(shuffleMobEl));
    }

    /* ── Manifesto mode (in-page transition) ── */
    let manifestoMode = false;
    /* Mobile logo animation targets — lerped each frame in the render loop */
    let mobLogoScale = 1.12, mobLogoScaleTarget = 1.12;
    let mobLogoYPos  = 0.39, mobLogoYPosTarget  = 0.39;
    const MANIFESTO_LOGO_SCALE = 0.55;
    const MANIFESTO_LOGO_YPOS  = 0.19;
    /* Desktop logo animation targets */
    let deskLogoScale = 0.525, deskLogoScaleTarget = 0.525;
    let deskLogoYPos  = 0.5,   deskLogoYPosTarget  = 0.5;
    let deskLogoXPos  = 0.5,   deskLogoXPosTarget  = 0.5;
    const DESK_MANIFESTO_LOGO_SCALE = 0.38;
    const DESK_MANIFESTO_LOGO_YPOS  = 0.5;
    const DESK_MANIFESTO_LOGO_XPOS  = 0.28;
    const LOGO_LERP = 0.08;

    const mobileUI              = document.getElementById('mobile-ui');
    const uiOverlay             = document.getElementById('ui-overlay');
    const taglineBtn            = document.getElementById('mobile-tagline-btn');
    const manifestoBackBtn      = document.getElementById('manifesto-back-btn');
    const desktopTaglineBtn     = document.getElementById('desktop-tagline-btn');
    const desktopManifestoBack  = document.getElementById('desktop-manifesto-back-btn');

    function enterManifesto() {
      manifestoMode = true;
      /* Mobile */
      mobLogoScaleTarget = MANIFESTO_LOGO_SCALE;
      mobLogoYPosTarget  = MANIFESTO_LOGO_YPOS;
      mobileUI.classList.add('manifesto-mode');
      /* Desktop — logo moves left, text fades in on right */
      deskLogoScaleTarget = DESK_MANIFESTO_LOGO_SCALE;
      deskLogoYPosTarget  = DESK_MANIFESTO_LOGO_YPOS;
      deskLogoXPosTarget  = DESK_MANIFESTO_LOGO_XPOS;
      uiOverlay.classList.add('desktop-manifesto-mode');
    }
    function exitManifesto() {
      manifestoMode = false;
      /* Mobile */
      mobLogoScaleTarget = 1.12;
      mobLogoYPosTarget  = 0.39;
      mobileUI.classList.remove('manifesto-mode');
      /* Desktop — fade text out first, then move logo back */
      uiOverlay.classList.remove('desktop-manifesto-mode');
      setTimeout(() => {
        deskLogoScaleTarget = 0.525;
        deskLogoYPosTarget  = 0.5;
        deskLogoXPosTarget  = 0.5;
      }, 350);
    }

    if (taglineBtn)            taglineBtn.addEventListener('click', enterManifesto);
    if (manifestoBackBtn)      manifestoBackBtn.addEventListener('click', exitManifesto);
    if (desktopTaglineBtn)     desktopTaglineBtn.addEventListener('click', enterManifesto);
    if (desktopManifestoBack)  desktopManifestoBack.addEventListener('click', exitManifesto);

    /* Pop sound via Web Audio API */
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playPop() {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.type = 'sine';
      osc.frequency.setValueAtTime(600, audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.08);
      gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.12);
      osc.start(audioCtx.currentTime);
      osc.stop(audioCtx.currentTime + 0.12);
    }

    /* Get sticker size based on screen width */
    function getStickerSize() {
      if (window.innerWidth <= 480) return 150;
      if (window.innerWidth <= 768) return 200;
      return 400;
    }

    /* Place sticker at coordinates */
    function placeSticker(x, y) {
      if (!stickerMode) return;
      if (stickerCount >= MAX_STICKERS) {
        const stamps = stickerLayer.querySelectorAll('.sticker-stamp');
        stamps.forEach((s, i) => {
          setTimeout(() => { s.classList.add('popping-out'); }, i * 40);
        });
        setTimeout(() => {
          stickerLayer.innerHTML = '';
          stickerCount = 0;
        }, stamps.length * 40 + 450);
        return;
      }
      playPop();
      const rot = Math.floor(Math.random() * 360);
      const sticker = document.createElement('div');
      sticker.className = 'sticker-stamp';
      sticker.style.left = x + 'px';
      sticker.style.top = y + 'px';
      sticker.style.zIndex = 1000 + stickerCount;
      sticker.style.setProperty('--rot', rot + 'deg');
      const src = STICKER_SRCS[stickerIndex];
      sticker.innerHTML = '<img src="' + src + '" alt="" draggable="false" />';
      stickerLayer.appendChild(sticker);
      stickerCount++;
      /* Advance to next sticker, loop around */
      stickerIndex = (stickerIndex + 1) % STICKER_SRCS.length;
      stickerCursor.src = STICKER_SRCS[stickerIndex];
    }

    /* Check if point overlaps the shuffle button */
    function isOverShuffleBtn(x, y) {
      const btns = [document.getElementById('shufflemobMktg'), document.getElementById('mobile-shuffle-btn'), shuffleEl];
      for (const btn of btns) {
        if (!btn) continue;
        const r = btn.getBoundingClientRect();
        if (x >= r.left && x <= r.right && y >= r.top && y <= r.bottom) return true;
      }
      return false;
    }

    /* Click/tap to place sticker */
    stickerLayer.addEventListener('click', (e) => {
      if (isOverShuffleBtn(e.clientX, e.clientY)) return;
      placeSticker(e.clientX, e.clientY);
    });
    /* Touch support for sticker placement */
    stickerLayer.addEventListener('touchend', (e) => {
      if (!stickerMode || !e.changedTouches.length) return;
      const t = e.changedTouches[0];
      if (isOverShuffleBtn(t.clientX, t.clientY)) {
        const btn = document.getElementById('mobile-shuffle-btn') || shuffleEl;
        if (btn) btn.click();
        return;
      }
      e.preventDefault();
      placeSticker(t.clientX, t.clientY);
    });

    /* ═══ HELPERS ═══ */
    function coverRect(iw, ih, cw, ch) {
      const ir = iw / ih, cr = cw / ch;
      let sx, sy, sw, sh;
      if (ir > cr) { sh = ih; sw = ih * cr; sx = (iw - sw) / 2; sy = 0; }
      else         { sw = iw; sh = iw / cr; sx = 0; sy = (ih - sh) / 2; }
      return { sx, sy, sw, sh };
    }

    /* contain-fit: returns dest x, y, w, h to fit image inside container */
    function containRect(iw, ih, cw, ch) {
      const scale = Math.min(cw / iw, ch / ih);
      const dw = iw * scale;
      const dh = ih * scale;
      return { dx: (cw - dw) / 2, dy: (ch - dh) / 2, dw, dh };
    }

    /* width-fit: scale to fill width, center vertically (no horizontal crop) */
    function widthFitRect(iw, ih, cw, ch) {
      const scale = cw / iw;
      const dw = cw;
      const dh = ih * scale;
      return { dx: 0, dy: (ch - dh) / 2, dw, dh };
    }

    function desktopTreatmentRect(iw, ih, cw, ch, align) {
      const base = coverRect(iw, ih, cw, ch);
      const a = align || {};

      /* Normalize slight source AR drift so mixed source sizes align consistently. */
      const srcAR = iw / ih;
      const arZoom = Math.max(0.92, Math.min(1.08, DESKTOP_BASE_ASPECT / srcAR));
      const requestedZoom = Math.max(0.75, Math.min(1.25, (a.zoom || 1) * arZoom));
      const minZoom = Math.max(base.sw / iw, base.sh / ih);
      const zoom = Math.max(minZoom, requestedZoom);

      let sw = base.sw / zoom;
      let sh = base.sh / zoom;
      let sx = base.sx - (sw - base.sw) / 2;
      let sy = base.sy - (sh - base.sh) / 2;

      const xPx = (a.xOff || 0) * cw;
      const yPx = (a.yOff || 0) * ch;
      sx -= xPx * (sw / cw);
      sy -= yPx * (sh / ch);

      sx = Math.max(0, Math.min(iw - sw, sx));
      sy = Math.max(0, Math.min(ih - sh, sy));

      return { sx, sy, sw, sh };
    }

    /* ═══ FLOWING LIQUID BLOB — big, organic, ribbon-like ═══ */
    function drawBlob(ctx, x, y, rx, ry, angle, alpha, t) {
      if (alpha < 0.003 || rx < 2) return;
      ctx.save();
      ctx.globalAlpha = alpha;
      ctx.translate(x, y);
      ctx.rotate(angle);
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      const N = 96; /* more segments = smoother organic shape */
      for (let i = 0; i <= N; i++) {
        const a = (i / N) * Math.PI * 2;
        /* multiple harmonics for that flowing red-blob feel */
        const w = 1
          + 0.10 * Math.sin(a * 2  + t * 0.0018)
          + 0.07 * Math.sin(a * 3  + t * 0.0028 + 0.8)
          + 0.05 * Math.sin(a * 5  + t * 0.0038 + 2.1)
          + 0.04 * Math.sin(a * 7  + t * 0.0015 + 3.5)
          + 0.03 * Math.sin(a * 11 + t * 0.0022 + 5.0)
          + 0.02 * Math.sin(a * 13 + t * 0.0045 + 1.3);
        const px = Math.cos(a) * rx * w;
        const py = Math.sin(a) * ry * w;
        i === 0 ? ctx.moveTo(px, py) : ctx.lineTo(px, py);
      }
      ctx.closePath();
      ctx.fill();
      ctx.restore();
    }

    /* ═══ INVERSION ═══ */
    function checkInversion(bx, by, br) {
      [socialEl, gridWmEl, shuffleEl, labelEl].forEach(el => {
        const r = el.getBoundingClientRect();
        const cx = r.left + r.width / 2;
        const cy = r.top + r.height / 2;
        const d = Math.hypot(bx - cx, by - cy);
        el.classList.toggle('inverted', d < br + Math.max(r.width, r.height) * 0.6);
      });
    }

    /* ═══ PRELOADING ═══ */
    const isPortraitDevice = window.innerHeight > window.innerWidth;
    let logoLoaded = false, firstReady = false, firstImageLoaded = false;

    function startApp() {
      if (firstReady) return;
      if (!logoLoaded || !firstImageLoaded) return;
      firstReady = true;
      prepareWhiteLogo();
      loader.classList.add('hidden');
      setTimeout(() => loader.remove(), 800);
      cursorX = prevCX = W / 2;
      cursorY = prevCY = H / 2;
      lastTreatmentSwitch = performance.now();
      requestAnimationFrame(render);
    }

    logoImg.onload = () => { logoLoaded = true; prepareWhiteLogo(); startApp(); };
    logoImg.onerror = () => { logoLoaded = true; startApp(); };
    if (logoImg.complete && logoImg.naturalWidth) { logoLoaded = true; prepareWhiteLogo(); }

    /* Load only the set needed for current device first */
    const primaryKey = isPortraitDevice ? 'mobileSrc' : 'src';
    const secondaryKey = isPortraitDevice ? 'src' : 'mobileSrc';
    const primaryArr = isPortraitDevice ? mobileTreatmentImages : treatmentImages;
    const secondaryArr = isPortraitDevice ? treatmentImages : mobileTreatmentImages;

    /* Load primary set — start app as soon as logo + first treatment are ready */
    TREATMENTS.forEach((t, i) => {
      const img = new Image(); img.src = t[primaryKey];
      img.onload = () => { if (i === 0) { firstImageLoaded = true; startApp(); } };
      img.onerror = () => { if (i === 0) { firstImageLoaded = true; startApp(); } };
      if (img.complete && img.naturalWidth && i === 0) firstImageLoaded = true;
      primaryArr[i] = img;
    });

    /* Lazy-load secondary set after primary is done */
    window.addEventListener('load', () => {
      TREATMENTS.forEach((t, i) => {
        const img = new Image(); img.src = t[secondaryKey];
        secondaryArr[i] = img;
      });
    });

    resize();
    /* If logo already loaded and first image cached, start immediately */
    if (logoLoaded && primaryArr[0] && primaryArr[0].complete && primaryArr[0].naturalWidth) {
      firstImageLoaded = true; startApp();
    }
    /* Safety timeout — never stay stuck on loader for more than 5s */
    setTimeout(() => { logoLoaded = true; firstImageLoaded = true; startApp(); }, 5000);

    /* ═══ RENDER ═══ */
    let lastSeed = 0;

    function render() {
      const now = performance.now();

      /* ── Auto-cycle treatments while hovering (smooth crossfade) — skip in sticker mode ── */
      if (!stickerMode && mouseIn && now - lastTreatmentSwitch > TREATMENT_INTERVAL) {
        prevTreatment = currentTreatment;
        currentTreatment = (currentTreatment + 1) % TREATMENTS.length;
        labelEl.textContent = TREATMENTS[currentTreatment].name;
        lastTreatmentSwitch = now;
        treatmentFade = 0.0;
      }
      if (treatmentFade < 1.0) {
        treatmentFade = Math.min(1.0, (now - lastTreatmentSwitch) / TREATMENT_FADE_MS);
      }

      /* ── Cursor lerp (smooth, flowing) ── */
      prevCX = cursorX; prevCY = cursorY;
      cursorX += (mouseX - cursorX) * LERP;
      cursorY += (mouseY - cursorY) * LERP;
      const vx = cursorX - prevCX;
      const vy = cursorY - prevCY;
      const speed = Math.hypot(vx, vy);
      const angle = Math.atan2(vy, vx);

      /* ── Alpha fade ── */
      /* Disable blob reveal in manifesto mode */
      if (manifestoMode) { targetAlpha = 0; curAlpha = 0; trail.length = 0; }
      curAlpha += (targetAlpha - curAlpha) * 0.04; /* slower fade = more presence */

      /* ── Trail — denser, longer-lived ── */
      if (mouseIn && speed > 0.15) {
        trail.push({ x: cursorX, y: cursorY, t: now, speed, angle });
      }
      while (trail.length && now - trail[0].t > TRAIL_LIFE) trail.shift();

      /* ── Turbulence shimmer ── */
      const seedFrame = Math.floor(now / 150);
      if (seedFrame !== lastSeed) {
        lastSeed = seedFrame;
        turbEl.setAttribute('seed', seedFrame % 999);
      }

      /* ════════════════════════════
         MAIN COMPOSITE
         ════════════════════════════ */
      mainCtx.clearRect(0, 0, W, H);

      /* ── Logo: static, no drift/breathing ── */
      const breathe = 1;
      const px = 0;
      const py = 0;

      /* 1. Dark bg */
      mainCtx.fillStyle = '#1a1a1a';
      mainCtx.fillRect(0, 0, W, H);

      /* 2. Draw white logo — ALWAYS visible in both modes */
      const isPortrait = H > W;
      const isMobileLayout = isPortrait || (H <= 500 && W <= 1024);
      /* ── Mobile logo tuning (lerp toward target each frame) ── */
      mobLogoScale += (mobLogoScaleTarget - mobLogoScale) * LOGO_LERP;
      mobLogoYPos  += (mobLogoYPosTarget  - mobLogoYPos)  * LOGO_LERP;
      const MOB_LOGO_W_SCALE = mobLogoScale;
      const MOB_LOGO_Y_POS   = mobLogoYPos;
      /* ── Desktop logo tuning (lerp toward target each frame) ── */
      deskLogoScale += (deskLogoScaleTarget - deskLogoScale) * LOGO_LERP;
      deskLogoYPos  += (deskLogoYPosTarget  - deskLogoYPos)  * LOGO_LERP;
      deskLogoXPos  += (deskLogoXPosTarget  - deskLogoXPos)  * LOGO_LERP;
      if (logoCanvas.width > 1) {
        mainCtx.globalCompositeOperation = 'screen';
        if (isMobileLayout) {
          /* Width-fit with independent horizontal scaling */
          const wf = widthFitRect(logoCanvas.width, logoCanvas.height, W, H);
          const bw = wf.dw * MOB_LOGO_W_SCALE;
          const bh = wf.dh * MOB_LOGO_W_SCALE; /* keep aspect ratio */
          const bx = (W - bw) / 2;
          const by = H * MOB_LOGO_Y_POS - bh / 2;
          mainCtx.drawImage(logoCanvas, 0, 0, logoCanvas.width, logoCanvas.height, bx, by, bw, bh);
        } else {
          /* Scale the overlay to match the treatment's cover-crop zoom.
             containRect can't be used here — it switches between width-
             and height-constrained modes at different ARs, causing the
             overlay to track the wrong dimension.  Instead, compute the
             overlay width directly from the treatment crop ratio so it
             always scales with W (same as the baked-in logo). */
          const tImg = treatmentImages[currentTreatment];
          const tw = tImg ? (tImg.naturalWidth  || 2752) : 2752;
          const th = tImg ? (tImg.naturalHeight || 1536) : 1536;
          const align = TREATMENTS[currentTreatment].desktopAlign;
          const dCur = desktopTreatmentRect(tw, th, W, H, align);
          const refW = H * 16 / 9;
          const dRef = desktopTreatmentRect(tw, th, refW, H, align);
          const cropCorrection = dRef.sw / dCur.sw;
          const adjScale = deskLogoScale * cropCorrection;
          /* Cap logo size on square/portrait-ish viewports so it doesn't overwhelm */
          const arClamp = Math.min(1, (W / H) / (16 / 9));
          const lw = adjScale * W * arClamp;
          const lh = lw * logoCanvas.height / logoCanvas.width;
          const bx = W * deskLogoXPos - lw / 2;
          const by = H * deskLogoYPos - lh / 2;
          mainCtx.drawImage(logoCanvas, 0, 0, logoCanvas.width, logoCanvas.height, bx, by, lw, lh);
        }
        mainCtx.globalCompositeOperation = 'source-over';
      }

      /* 3-4. Blob reveal + treatments — only in reveal mode (skip in manifesto) */
      if (!stickerMode && !manifestoMode) {
        /* BLOB MASK */
        blobCtx.clearRect(0, 0, W, H);

        if (curAlpha > 0.003) {
          const REST = W <= 480 ? 35 : W <= 768 ? 50 : W <= 1024 ? 75 : 100;
          const stretch = Math.min(speed * 4, 140);
          const rx = REST + stretch;
          const ry = Math.max(REST - stretch * 0.3, 45);

          drawBlob(blobCtx, cursorX, cursorY, rx, ry, angle, curAlpha, now);

          for (let i = 0; i < trail.length; i++) {
            const p = trail[i];
            const age = now - p.t;
            const life = Math.max(0, 1 - age / TRAIL_LIFE);
            const eased = life * life;
            const op = eased * 0.65 * curAlpha;
            const tr = REST * eased * 0.7;
            const tsx = tr + Math.min(p.speed * 2, 60) * eased;
            const tsy = Math.max(tr - Math.min(p.speed * 0.5, 20) * eased, 18);
            drawBlob(blobCtx, p.x, p.y, tsx, tsy, p.angle, op, now);
          }
        }

        /* Blur + liquid distort */
        blurCtx.clearRect(0, 0, W, H);
        blurCtx.filter = 'url(#liquid-distort) blur(14px)';
        blurCtx.drawImage(blobCanvas, 0, 0, blobCanvas.width, blobCanvas.height, 0, 0, W, H);
        blurCtx.filter = 'none';

        /* Cut out blob shapes */
        mainCtx.globalCompositeOperation = 'destination-out';
        mainCtx.drawImage(blurCanvas, 0, 0, blurCanvas.width, blurCanvas.height, 0, 0, W, H);

        /* Draw treatment behind the cut-outs */
        mainCtx.globalCompositeOperation = 'destination-over';

        /* Pick the right image set: mobile 9:16 for portrait, desktop 16:9 for landscape */
        const activeImages = isPortrait ? mobileTreatmentImages : treatmentImages;

        function drawTreatment(idx, alpha) {
          const img = activeImages[idx];
          const iw = img ? (img.videoWidth || img.naturalWidth) : 0;
          const ih = img ? (img.videoHeight || img.naturalHeight) : 0;
          if (!iw || !ih) return;
          mainCtx.globalAlpha = alpha;
          const c = coverRect(iw, ih, W, H);
          if (isPortrait) {
            /* Per-treatment mobile Y offset */
            const yOff = H * (TREATMENTS[idx].mobileYOff || 0);
            /* Primary draw: shifted up to align logo */
            mainCtx.drawImage(img, c.sx, c.sy, c.sw, c.sh, 0, yOff, W, H);
            /* Fill only the bottom gap (below the primary draw) — clip to prevent ghost logo */
            if (yOff < 0) {
              mainCtx.save();
              mainCtx.beginPath();
              mainCtx.rect(0, H + yOff, W, -yOff);
              mainCtx.clip();
              mainCtx.drawImage(img, c.sx, c.sy, c.sw, c.sh, 0, 0, W, H);
              mainCtx.restore();
            }
          } else {
            const d = desktopTreatmentRect(iw, ih, W, H, TREATMENTS[idx].desktopAlign);
            mainCtx.drawImage(img, d.sx, d.sy, d.sw, d.sh, 0, 0, W, H);
          }
        }

        if (treatmentFade < 1.0 && prevTreatment !== currentTreatment) {
          const ease = treatmentFade * treatmentFade * (3 - 2 * treatmentFade);
          drawTreatment(prevTreatment, 1.0 - ease);
          drawTreatment(currentTreatment, ease);
        } else {
          drawTreatment(currentTreatment, 1.0);
        }

        mainCtx.globalAlpha = 1.0;
        mainCtx.globalCompositeOperation = 'source-over';
      }

      /* ── DOT GRID ── */
      dotCtx.clearRect(0, 0, W, H);
      if (dotPattern) {
        dotCtx.fillStyle = dotPattern;
        dotCtx.fillRect(0, 0, W, H);
      }

      /* ── INVERSION ── */
      if (!stickerMode) {
        const blobR = 180 + Math.min(speed * 5, 200);
        checkInversion(cursorX, cursorY, blobR);
      }

      requestAnimationFrame(render);
    }
  })();
  </script>
</body>
</html>
